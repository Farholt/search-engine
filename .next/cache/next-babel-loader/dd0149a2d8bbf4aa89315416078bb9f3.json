{"ast":null,"code":"import jsonResult from '../../shared/functions/convertDatasetToJson';\nimport { Centroid } from '../../shared/class/Centroid';\nimport pearson from '../../shared/functions/pearson';\n\nconst {\n  range,\n  map,\n  pipe,\n  flip,\n  forEach: forE,\n  all: every\n} = require('ramda');\n\nconst {\n  reduce,\n  forEach\n} = require('list/curried');\n\nconst random = from => to => from + Math.random() * (to - from);\n\nconst kMean = (req, res) => {\n  const CLUSTERS = 5;\n  const MAX_ITERATIONS = 50;\n  let k = random(1)(20);\n  const n = 706;\n  const centroids = [];\n\n  for (let i = 0; i < k; i++) {\n    centroids[i] = new Centroid();\n\n    for (let j = 0; j < n; j++) {\n      centroids[i].setWordCount(j, random(i)(n));\n    }\n  }\n\n  const blogs = jsonResult()[0].blogs;\n\n  for (let i = 0; i < MAX_ITERATIONS; i++) {\n    centroids.forEach(e => e.clearAssignments());\n\n    for (let j = 0; j < blogs.length; j++) {\n      let distance = Infinity;\n      let closest; // best\n\n      for (let k = 0; k < centroids.length; k++) {\n        const cDist = pearson(centroids[k], blogs[j]);\n\n        if (cDist < distance) {\n          closest = centroids[k];\n          distance = cDist;\n        }\n      }\n\n      closest.assign(blogs[j].name);\n    }\n  } // res.json(JSON.stringify(jsonResult()[0].blogs, null, 2))\n\n\n  res.json(JSON.stringify(centroids, null, 2));\n};\n\nexport default kMean;","map":{"version":3,"sources":["C:/Users/fredr/Documents/Universitet/HT20/2DV515 - Web Intelligence/A2/pages/api/blog.ts"],"names":["jsonResult","Centroid","pearson","range","map","pipe","flip","forEach","forE","all","every","require","reduce","random","from","to","Math","kMean","req","res","CLUSTERS","MAX_ITERATIONS","k","n","centroids","i","j","setWordCount","blogs","e","clearAssignments","length","distance","Infinity","closest","cDist","assign","name","json","JSON","stringify"],"mappings":"AACA,OAAOA,UAAP,MAAuB,6CAAvB;AAEA,SAASC,QAAT,QAAyB,6BAAzB;AACA,OAAOC,OAAP,MAAoB,gCAApB;;AAEA,MAAM;AAAEC,EAAAA,KAAF;AAASC,EAAAA,GAAT;AAAcC,EAAAA,IAAd;AAAoBC,EAAAA,IAApB;AAA0BC,EAAAA,OAAO,EAAEC,IAAnC;AAAyCC,EAAAA,GAAG,EAAEC;AAA9C,IAAwDC,OAAO,CAAC,OAAD,CAArE;;AACA,MAAM;AAAEC,EAAAA,MAAF;AAAUL,EAAAA;AAAV,IAAsBI,OAAO,CAAC,cAAD,CAAnC;;AAEA,MAAME,MAAM,GAAIC,IAAD,IAAmBC,EAAD,IAC/BD,IAAI,GAAGE,IAAI,CAACH,MAAL,MAAiBE,EAAE,GAAGD,IAAtB,CADT;;AAGA,MAAMG,KAAK,GAAG,CAACC,GAAD,EAAsBC,GAAtB,KAA+C;AAC3D,QAAMC,QAAQ,GAAG,CAAjB;AACA,QAAMC,cAAc,GAAG,EAAvB;AACA,MAAIC,CAAC,GAAGT,MAAM,CAAC,CAAD,CAAN,CAAU,EAAV,CAAR;AACA,QAAMU,CAAC,GAAG,GAAV;AAEA,QAAMC,SAAS,GAAG,EAAlB;;AAEA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,CAApB,EAAuBG,CAAC,EAAxB,EAA4B;AAC1BD,IAAAA,SAAS,CAACC,CAAD,CAAT,GAAe,IAAIxB,QAAJ,EAAf;;AACA,SAAK,IAAIyB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,CAApB,EAAuBG,CAAC,EAAxB,EAA4B;AAC1BF,MAAAA,SAAS,CAACC,CAAD,CAAT,CAAaE,YAAb,CAA0BD,CAA1B,EAA6Bb,MAAM,CAACY,CAAD,CAAN,CAAUF,CAAV,CAA7B;AACD;AACF;;AAED,QAAMK,KAAK,GAAG5B,UAAU,GAAG,CAAH,CAAV,CAAgB4B,KAA9B;;AAEA,OAAK,IAAIH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,cAApB,EAAoCI,CAAC,EAArC,EAAyC;AACvCD,IAAAA,SAAS,CAACjB,OAAV,CAAmBsB,CAAD,IAAOA,CAAC,CAACC,gBAAF,EAAzB;;AAEA,SAAK,IAAIJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGE,KAAK,CAACG,MAA1B,EAAkCL,CAAC,EAAnC,EAAuC;AACrC,UAAIM,QAAQ,GAAGC,QAAf;AACA,UAAIC,OAAJ,CAFqC,CAEzB;;AAEZ,WAAK,IAAIZ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGE,SAAS,CAACO,MAA9B,EAAsCT,CAAC,EAAvC,EAA2C;AACzC,cAAMa,KAAa,GAAGjC,OAAO,CAACsB,SAAS,CAACF,CAAD,CAAV,EAAeM,KAAK,CAACF,CAAD,CAApB,CAA7B;;AACA,YAAIS,KAAK,GAAGH,QAAZ,EAAsB;AACpBE,UAAAA,OAAO,GAAGV,SAAS,CAACF,CAAD,CAAnB;AACAU,UAAAA,QAAQ,GAAGG,KAAX;AACD;AACF;;AACDD,MAAAA,OAAO,CAACE,MAAR,CAAeR,KAAK,CAACF,CAAD,CAAL,CAASW,IAAxB;AACD;AACF,GAjC0D,CAmC3D;;;AACAlB,EAAAA,GAAG,CAACmB,IAAJ,CAASC,IAAI,CAACC,SAAL,CAAehB,SAAf,EAA0B,IAA1B,EAAgC,CAAhC,CAAT;AACD,CArCD;;AAuCA,eAAeP,KAAf","sourcesContent":["import { NextApiRequest, NextApiResponse } from 'next'\r\nimport jsonResult from '../../shared/functions/convertDatasetToJson'\r\n\r\nimport { Centroid } from '../../shared/class/Centroid'\r\nimport pearson from '../../shared/functions/pearson'\r\n\r\nconst { range, map, pipe, flip, forEach: forE, all: every } = require('ramda')\r\nconst { reduce, forEach } = require('list/curried')\r\n\r\nconst random = (from: number) => (to: number) =>\r\n  from + Math.random() * (to - from)\r\n\r\nconst kMean = (req: NextApiRequest, res: NextApiResponse) => {\r\n  const CLUSTERS = 5\r\n  const MAX_ITERATIONS = 50\r\n  let k = random(1)(20)\r\n  const n = 706\r\n\r\n  const centroids = []\r\n\r\n  for (let i = 0; i < k; i++) {\r\n    centroids[i] = new Centroid()\r\n    for (let j = 0; j < n; j++) {\r\n      centroids[i].setWordCount(j, random(i)(n))\r\n    }\r\n  }\r\n\r\n  const blogs = jsonResult()[0].blogs\r\n\r\n  for (let i = 0; i < MAX_ITERATIONS; i++) {\r\n    centroids.forEach((e) => e.clearAssignments())\r\n\r\n    for (let j = 0; j < blogs.length; j++) {\r\n      let distance = Infinity\r\n      let closest // best\r\n\r\n      for (let k = 0; k < centroids.length; k++) {\r\n        const cDist: number = pearson(centroids[k], blogs[j])\r\n        if (cDist < distance) {\r\n          closest = centroids[k]\r\n          distance = cDist\r\n        }\r\n      }\r\n      closest.assign(blogs[j].name)\r\n    }\r\n  }\r\n\r\n  // res.json(JSON.stringify(jsonResult()[0].blogs, null, 2))\r\n  res.json(JSON.stringify(centroids, null, 2))\r\n}\r\n\r\nexport default kMean\r\n"]},"metadata":{},"sourceType":"module"}